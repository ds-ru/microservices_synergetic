# globus\_parser

## Назначение

Микросервис предназначен для получения информации о товарах с сайта Globus. Сервис по справочнику SKU собирает данные о наименовании товара, бренде, объёме (мл, г, шт) и соответствующих единицах измерения. Использует асинхронные HTTP-запросы и парсинг встроенных JSON-структур на странице товара.

## Установка и запуск

```bash
pip install -r requirements.txt
uvicorn globus_parser:app --host 0.0.0.0 --port 8083
```

## API

### GET /globus

Параметры запроса:

* `min_row` (str): строка, с которой начинать обработку Excel-файла

#### Описание работы:

1. Сервис открывает Excel-файл `СправочникиПОЛН.xlsx` из сетевой директории Globus.
2. Фильтрует справочник по колонке `Код SKU`, исключая значения «Прочее» и «Общий итог».
3. По каждому SKU формирует URL вида `https://online.globus.ru/products/{sku_id}_ST/` и отправляет асинхронный запрос.
4. Из полученной HTML-страницы извлекаются данные JSON-формата из тега `<script id="__NEXT_DATA__">`.
5. Извлекаются следующие поля:

   * Наименование товара
   * Бренд
   * Объём (в мл, г или шт) и соответствующая единица измерения
6. Возвращается Excel-файл с колонками: `Код SKU`, `Наименование`, `Бренд`, `Объем`, `Ед. изм`

#### Пример запроса:

```http
GET /globus?min_row=2
```

#### Пример ответа:

Ответ — это Excel-файл (`Content-Disposition: attachment`) с результатами сбора данных.

## Примечания

* Файл справочника должен находиться по пути: `\\10.5.0.20\аналитики\PBI\ПРОДАЖИ\GLOBUS\СправочникиПОЛН.xlsx`
* Обрабатывается лист `SPR_DWH_SKU` с колонками `Код SKU`, `Уник. названия групп`
* Асинхронная загрузка данных использует `aiohttp` и `asyncio.Semaphore` для ограничения параллелизма
* Приоритет извлечения объёма: сначала мл → затем г → затем шт

## Зависимости

Основные используемые библиотеки:

* fastapi
* uvicorn
* pandas
* openpyxl
* aiohttp
* beautifulsoup4

Полный список см. в `requirements.txt`.

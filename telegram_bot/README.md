# telegram\_bot

## Назначение

Микросервис представляет собой Telegram-бота для проверки справочников товаров различных сетей на наличие ошибок. Бот позволяет авторизованным пользователям запрашивать автоматическую проверку и получать отчёт в виде Excel-документа. Поддерживается регистрация через команду `/register`, подтверждение регистрации администратором и управление выбором торговых сетей с помощью клавиатуры.

## Установка и запуск

```bash
pip install -r requirements.txt
python main.py
```

## Основной функционал

* Регистрация пользователей через Telegram с подтверждением администратором.
* Управление пользователями и ограничение количества запросов (антиспам).
* Загрузка справочников из путей, указанных в `file_path.json`.
* Проверка справочников на:

  * соответствие названий групп утверждённым категориям,
  * отсутствие корректной линейки `Baby` при наличии детских ключевых слов,
  * пустой или некорректный бренд ("Прочее", "Нет бренда" и др.).
* Генерация Excel-отчета с найденными проблемами.

## Структура файла `file_path.json`

```json
{
  "files": [
    { "name": "WB_1", "path": "\\xx.x.x.xx\\...\\СправочникиПОЛН_1.xlsx" },
    { "name": "Ozon_1", "path": "\\xx.x.x.xx\\...\\Spr_OZON.xlsx" },
    ...
  ]
}
```

## Принцип работы

1. Пользователь регистрируется через команду `/register`.
2. Администратор подтверждает регистрацию.
3. Пользователь нажимает кнопку "Получить отчет" и выбирает интересующие сети.
4. Система читает файл `file_path.json`, обрабатывает соответствующие справочники и проверяет их на наличие ошибок.
5. Если найдены проблемы — отправляется Excel-отчет с подробной информацией.
6. Если ошибок не найдено — бот сообщает об этом.

## Критерии ошибок

* **Несоответствие групп категорий** — `Уник. названия групп` отсутствует в утверждённом списке.
* **Некорректная линейка "Baby"** — в названии товара присутствуют детские ключевые слова, но линейка `Baby` не указана.
* **Некорректный бренд** — значения бренда отсутствуют или равны "Прочее", "Нет бренда" и аналогичным.

## Зависимости

Основные используемые библиотеки:

* telebot (pyTelegramBotAPI)
* pandas
* openpyxl
* requests
* fastapi (в отдельных модулях)

Полный список зависимостей — в `requirements.txt`.

## Примечания

* Бот использует файл `registrations.json` для хранения состояния пользователей.
* Поддерживается защита от перегрузки за счёт ограничения числа запросов в минуту.
* Все ошибки логируются в `bot.log`.

# detskiy\_mir\_parser

## Назначение

Микросервис предназначен для сбора наименований товаров с сайта Детский Мир по справочнику SKU. Использует веб-скрейпинг страниц поисковой выдачи, парсит встроенные JSON-данные с помощью BeautifulSoup и возвращает Excel-файл с найденными наименованиями товаров.

## Установка и запуск

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Запуск сервиса

```bash
uvicorn detskiy_mir_parser:app --host 0.0.0.0 --port 8082
```

## API

### GET /detskiy\_mir

Параметры запроса:

* `min_row` (str): строка, указывающая с какой строки начинать обработку Excel-файла

#### Описание работы:

1. Сервис открывает файл `СправочникиПОЛН.xlsx` из сетевого ресурса.
2. Фильтрует справочник по SKU, исключая «Прочее» и «Общий итог».
3. По каждому `Код SKU` выполняет запрос на сайт [https://www.detmir.ru](https://www.detmir.ru) и извлекает наименование товара из JSON-данных.
4. Возвращает Excel-файл с колонками: `Артикул`, `Наименование`, `Наименование новое`.

#### Пример запроса:

```http
GET /detskiy_mir?min_row=2
```

#### Пример ответа:

Excel-файл (`Content-Disposition: attachment`) с найденными наименованиями товаров.

## Примечания

* Обрабатываемый Excel-файл должен находиться по адресу: `\\10.5.0.20\аналитики\PBI\ПРОДАЖИ\ДМ\СправочникиПОЛН.xlsx`.
* Ожидается лист `SPR_DWH_SKU` с колонками `Код SKU`, `Название SKU в сети`, `Уник. названия групп`.
* В результат включаются только первые совпадения по SKU на сайте Детский Мир.
* Парсинг выполняется через HTML + JSON в теге `<script>`, не через API.

## Зависимости

Основные используемые библиотеки:

* fastapi
* uvicorn
* pandas
* openpyxl
* requests
* beautifulsoup4

Полный список зависимостей приведён в `requirements.txt`.
